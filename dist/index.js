import*as t from"react";import*as e from"react-dom";function r(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function n(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?r(Object(n),!0).forEach((function(e){i(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,d(n.key),n)}}function l(t,e,r){return e&&o(t.prototype,e),r&&o(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function i(t,e,r){return(e=d(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function u(){return u=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},u.apply(this,arguments)}function c(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,a,o,l,i=[],u=!0,c=!1;try{if(o=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(i.push(n.value),i.length!==e);u=!0);}catch(t){c=!0,a=t}finally{try{if(!u&&null!=r.return&&(l=r.return(),Object(l)!==l))return}finally{if(c)throw a}}return i}}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return s(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return s(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function d(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}var f=l((function t(){a(this,t),this.startOfMerge=!1,this.inMerge=!1}));function v(t){if(null==t)return"";var e=t.red?255*t.red:0,r=t.green?255*t.green:0,n=t.blue?255*t.blue:0;return"rgb(".concat(e,", ").concat(r,", ").concat(n,")")}function g(t){var e,r={};return t?(null!=(null===(e=t.foregroundColorStyle)||void 0===e?void 0:e.rgbColor)&&(r.color=v(t.foregroundColorStyle.rgbColor)),null!=t.fontFamily&&(r["font-family"]=t.fontFamily),null!=t.fontSize&&(r["font-size"]="".concat(t.fontSize,"pt")),null!=t.bold&&t.bold&&(r["font-weight"]="bold"),null!=t.italic&&t.italic&&(r["font-style"]="italic"),null!=t.strikethrough&&t.strikethrough&&(r["text-decoration"]="line-through"),null!=t.underline&&t.underline&&(r["text-decoration"]="underline"),r):r}function m(t){for(var e,r="";t>0;)e=(t-1)%26,r=String.fromCharCode(e+65)+r,t=(t-e-1)/26;return r}function p(t){for(var e=0,r=t.length,n=0;n<r;n++)e+=(t.charCodeAt(n)-64)*Math.pow(26,r-n-1);return e}function h(t){if(!t)return"";var e=t.effectiveFormat;return null==e||null==e.numberFormat||null==e.numberFormat.pattern?"":e.numberFormat.pattern.startsWith('"$"')?b.currencyInput:"PERCENT"==e.numberFormat.type?b.percentInput:""}var b={error:"gtable-error",table:"gtable",thead:"gtable-head",th:"gtable-column-head",tbody:"gtable-body",tr:"gtable-row",td:"gtable-cell",input:"gtable-input",dirtyInput:"gtable-unsaved-changes",currencyInput:"gtable-currency",percentInput:"gtable-percentage"},y=l((function t(){a(this,t),this.columnTabbing=!1,this.effects=[],this.configurable=function(){return!1},this.submitHandler=function(){},this.createmaxtrix=!1})),w=l((function t(){a(this,t),this.settings=new y,this.numrows=0,this.numcols=0,this.rowSizes=[],this.colSizes=[],this.data=[],this.merges=[]})),x=l((function t(){a(this,t),this.range="",this.values=[[]]})),C=t.createContext(b),S=t.createContext(new w),O=t.createContext([]);function E(e){var r,a,o=t.useContext(C),l=t.useContext(S),i=t.useContext(O),u=(null===(r=e.data)||void 0===r||null===(a=r.effectiveValue)||void 0===a?void 0:a.numberValue)||0,s=h(e.data);s==b.currencyInput&&(u=parseFloat(u.toFixed(2))),s==b.percentInput&&(u=parseFloat((100*u).toFixed(6)),e.style["padding-right"]="1.01em");var d=function(t,e){var r=n({},t);return e==b.percentInput&&(r["padding-right"]="1.01em"),r.border="none",r["max-height"]="",r.height="",r.width=parseFloat(r.width.replace("px",""))-(parseInt(r["border-left"],10)||1)+"px",r}(e.style,s),f=c(t.useState(u),1)[0],v=c(t.useState(u.toString()),2),g=v[0],m=v[1],p=c(t.useState(""),2),y=p[0],w=p[1],x=function(t){t.target.select()};return t.createElement("input",{className:o.input+" "+s+" "+y,style:d,"data-orig":u,value:g,tabIndex:l.settings.columnTabbing?e.col:e.row,onChange:function(t){var r=function(t){return(t=(t=t.replace(/[^0-9\-\.]+/g,"")).replace(/(?<=(.*\..*))\.\./g,"")).replace(/(?!^)\-/g,"")}(t.target.value),n=r?parseFloat(r):0;n!=f?(w(o.dirtyInput),s==o.percentInput&&(n/=100),function(t,e,r){t.push({range:e,values:[[r]]})}(i,e.address,n)):(w(""),function(t,e){for(var r=0;r<t.length;r++){var n;(null===(n=t[r])||void 0===n?void 0:n.range)==e&&t.splice(r,1)}}(i,e.address)),m(r)},onFocus:x,onClick:x,onKeyDown:function(t){"Enter"===t.key&&l.settings.submitHandler(i)}})}function I(r,n,a){r=r.replace("#",""),e.createRoot(document.getElementById(r)).render(t.createElement(j,{data:n,settings:a}))}function j(e){var r,n,a,o,l,i,u,c,s,d,f,v,g,m,p=t.useContext(C);if("error"in e.data)return t.createElement("table",{className:p.table+" "+p.error});e.data=e.data;var h=(null===(r=e.data.sheets)||void 0===r||null===(n=r[0])||void 0===n||null===(a=n.data)||void 0===a||null===(o=a[0])||void 0===o?void 0:o.rowData)||[],b=(null===(l=e.data.sheets)||void 0===l||null===(i=l[0])||void 0===i||null===(u=i.data)||void 0===u||null===(c=u[0])||void 0===c?void 0:c.rowMetadata)||[],w=(null===(s=e.data.sheets)||void 0===s||null===(d=s[0])||void 0===d||null===(f=d.data)||void 0===f||null===(v=f[0])||void 0===v?void 0:v.columnMetadata)||[],x=(null===(g=e.data.sheets)||void 0===g||null===(m=g[0])||void 0===m?void 0:m.merges)||[],O=e.settings||new y,E=e.data.numrows,I=e.data.numcols;if(!E||!I){var j=function(t){for(var e={numrows:t.length,numcols:0},r=0;r<e.numrows;r++){var n,a,o=null===(n=t[r])||void 0===n||null===(a=n.values)||void 0===a?void 0:a.length;o&&o>e.numcols&&(e.numcols=o)}return e}(h);E=j.numrows,I=j.numcols}O.createmaxtrix&&(e.data.numrows=E,e.data.numcols=I,function(t){for(var e=0;e<t.numrows;e++){t.data[e]=[];for(var r=0;r<t.numcols;r++){var n,a,o,l,i,u,c,s,d,f=null===(n=t.sheets)||void 0===n||null===(a=n[0])||void 0===a||null===(o=a.data)||void 0===o||null===(l=o[0])||void 0===l||null===(i=l.rowData)||void 0===i||null===(u=i[e])||void 0===u||null===(c=u.values)||void 0===c?void 0:c[r];f?null===(s=t.data[e])||void 0===s||s.push(f):null===(d=t.data[e])||void 0===d||d.push(null)}}}(e.data));for(var k={settings:O,numrows:E,numcols:I,rowSizes:b,colSizes:w,data:h,merges:x},z=0;z<O.effects.length;z++)t.useEffect(O.effects[z]);return t.createElement(S.Provider,{value:k},t.createElement("table",{className:p.table},t.createElement(F,null),t.createElement(P,null)))}function F(){for(var e,r=t.useContext(C),n=t.useContext(S),a=[],o=0;o<n.numcols;o++){var l=(e=n.colSizes[o],{width:"".concat((null==e?void 0:e.pixelSize)||0,"px")});a.push(t.createElement("th",{className:r.th,style:l},m(o+1)))}return t.createElement("thead",{className:r.thead},a)}function P(){for(var e=t.useContext(C),r=t.useContext(S),n=[],a=0;a<r.numrows;a++)r.data[a]&&n.push(t.createElement(k,{row:a}));return t.createElement("tbody",{className:e.tbody,onKeyDown:function(t){"Enter"===t.key&&r.settings.submitHandler()}},n)}function k(e){for(var r=t.useContext(C),n=t.useContext(S),a=[],o=0;o<n.numcols;o++)a.push(t.createElement(z,{row:e.row,col:o}));var l,i=(l=n.rowSizes[e.row],{height:"".concat((null==l?void 0:l.pixelSize)||0,"px")});return t.createElement("tr",{className:r.tr,style:i},a)}function z(e){var r,a,o=t.useContext(C),l=t.useContext(S),i=e.row,c=e.col,s=null===(r=l.data[i])||void 0===r||null===(a=r.values)||void 0===a?void 0:a[c],d=l.rowSizes[i],p=l.colSizes[c],b={},y={},w=o.td,x=function(t,e,r){var a=new f,o=t.filter((function(t){return t.startRowIndex==e&&t.startColumnIndex==r}));return a.startOfMerge=o.length>0,a.startOfMerge?(a.context=n({},o[0]),a):(o=t.filter((function(t){return(t.startRowIndex||0)<=e&&(t.endRowIndex||0)>e&&(t.startColumnIndex||0)<=r&&(t.endColumnIndex||0)>r})),a.inMerge=o.length>0,a.inMerge&&(a.context=n({},o[0])),a)}(l.merges,i,c);if(x.inMerge&&!x.startOfMerge)return null;if(b=function(t,e,r){var n,a={},o=null==t?void 0:t.effectiveFormat;if(!o)return a;null!=(null===(n=o.backgroundColorStyle)||void 0===n?void 0:n.rgbColor)?a["background-color"]=v(o.backgroundColorStyle.rgbColor):null!=o.backgroundColor&&(a["background-color"]=v(o.backgroundColor));var l=o.horizontalAlignment;null!=l&&(a["text-align"]=l);var i=o.verticalAlignment;null!=i&&(a["vertical-align"]=i);var u=o.padding;if(null!=u)for(var c=0,s=Object.entries(u);c<s.length;c++){var d=s[c];a["padding-".concat(d[0])]="".concat(d[1]||0,"px")}var f=o.borders;if(f)for(var m=0,p=Object.entries(f);m<p.length;m++){var h,b=p[m],y=b[1];if(y&&null!=(null===(h=y.colorStyle)||void 0===h?void 0:h.rgbColor)){var w="".concat(y.width||0,"px ").concat(y.style||"solid"," ").concat(v(y.colorStyle.rgbColor));a["border-".concat(b[0])]=w}}var x=o.textFormat;if(null!=x&&Object.assign(a,g(x)),null!=o.wrapStrategy&&("OVERFLOW_CELL"==o.wrapStrategy&&(a.overflow="visible",a["white-space"]="nowrap"),"CLIP"==o.wrapStrategy&&(a.overflow="hidden",a["white-space"]="nowrap"),"WRAP"==o.wrapStrategy&&(a["white-space"]="pre-wrap")),e){var C=e.pixelSize||0;a["max-height"]="".concat(C,"px"),a.height="".concat(C,"px")}if(r){var S=r.pixelSize||0;a["max-width"]="".concat(S,"px"),a.width="".concat(S,"px")}return a}(s,d,p),x.startOfMerge){var O=x.context;y.colspan=(O.endColumnIndex||0)-(O.startColumnIndex||0),y.rowspan=(O.endRowIndex||0)-(O.startRowIndex||0)}y["data-range"]=m(c+1)+(i+1),y["data-col"]=c,y["data-row"]=i;var I=[];return l.settings.configurable(s)?(I.push(t.createElement(E,{data:s,style:n({},b),row:i,col:c,address:y["data-range"]})),w+=" "+h(s),b.padding="0",b["background-color"]="red"):I.push(t.createElement(R,{data:s})),null!=s&&s.note&&(y.title=s.note,y["data-toggle"]="tooltip"),t.createElement("td",u({className:w,style:b},y),I)}function R(e){if(e.data){if(null==e.data.textFormatRuns)return t.createElement(t.Fragment,null,e.data.formattedValue||"");for(var r=[],n=e.data.textFormatRuns.length-1,a=0;a<=n;a++){var o,l,i,u,c=null===(o=e.data.textFormatRuns[a])||void 0===o?void 0:o.format,s=e.data.formattedValue||"",d=0==a?0:(null===(l=e.data.textFormatRuns[a])||void 0===l?void 0:l.startIndex)||0,f=a==n?s.length:((null===(i=e.data.textFormatRuns[a+1])||void 0===i?void 0:i.startIndex)||0)-1;s=s.slice(d,f);var v=g(c),m=t.createElement("p",{style:v});m.props.children=[],null!=c&&null!==(u=c.link)&&void 0!==u&&u.uri?m.props.children.push(t.createElement("a",{href:c.link.uri,target:"_blank"},s)):m.props.children.push(t.createElement(t.Fragment,null,s)),r.push(m)}return t.createElement(t.Fragment,null,r)}return t.createElement(t.Fragment,null)}export{j as GTable,b as GTableClasses,x as GTableInputData,y as GTableSettings,m as columnToLetter,p as letterToColumn,I as renderGTable};
