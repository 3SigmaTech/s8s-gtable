import*as e from"react";import*as t from"react-dom";function r(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function n(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,d(n.key),n)}}function l(e,t,r){return t&&a(e.prototype,t),r&&a(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function i(e,t,r){return(t=d(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function u(){return u=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},u.apply(this,arguments)}function c(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,l,i=[],u=!0,c=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(i.push(n.value),i.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=r.return&&(l=r.return(),Object(l)!==l))return}finally{if(c)throw o}}return i}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return s(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function d(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}var f=l((function e(){o(this,e),this.startOfMerge=!1,this.inMerge=!1}));function v(e){for(var t={numrows:e.length,numcols:0},r=0;r<t.numrows;r++){var n,o,a=null===(n=e[r])||void 0===n||null===(o=n.values)||void 0===o?void 0:o.length;a&&a>t.numcols&&(t.numcols=a)}return t}function g(e){if(null==e)return"";var t=e.red?255*e.red:0,r=e.green?255*e.green:0,n=e.blue?255*e.blue:0;return"rgb(".concat(t,", ").concat(r,", ").concat(n,")")}function m(e){var t,r={};return e?(null!=(null===(t=e.foregroundColorStyle)||void 0===t?void 0:t.rgbColor)&&(r.color=g(e.foregroundColorStyle.rgbColor)),null!=e.fontFamily&&(r.fontFamily=e.fontFamily),null!=e.fontSize&&(r.fontSize="".concat(e.fontSize,"pt")),null!=e.bold&&e.bold&&(r.fontWeight="bold"),null!=e.italic&&e.italic&&(r.fontStyle="italic"),null!=e.strikethrough&&e.strikethrough&&(r.textDecoration="line-through"),null!=e.underline&&e.underline&&(r.textDecoration="underline"),r):r}function p(e){for(var t,r="";e>0;)t=(e-1)%26,r=String.fromCharCode(t+65)+r,e=(e-t-1)/26;return r}function b(e){for(var t=0,r=e.length,n=0;n<r;n++)t+=(e.charCodeAt(n)-64)*Math.pow(26,r-n-1);return t}function h(e){return e.replace(/\w\S*/g,(function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}))}function y(e){if(!e)return"";var t=e.effectiveFormat;return null==t||null==t.numberFormat||null==t.numberFormat.pattern?"":t.numberFormat.pattern.startsWith('"$"')?w.currencyInput:"PERCENT"==t.numberFormat.type?w.percentInput:""}var w={error:"gtable-error",table:"gtable",thead:"gtable-head",th:"gtable-column-head",tbody:"gtable-body",tr:"gtable-row",td:"gtable-cell",input:"gtable-input",dirtyInput:"gtable-unsaved-changes",currencyInput:"gtable-currency",percentInput:"gtable-percentage"},x=l((function e(){o(this,e),this.columnTabbing=!1,this.effects=[],this.configurable=function(){return!1},this.submitHandler=function(){},this.createmaxtrix=!1})),C=l((function e(){o(this,e),this.settings=new x,this.numrows=0,this.numcols=0,this.rowSizes=[],this.colSizes=[],this.data=[],this.merges=[]})),S=l((function e(){o(this,e),this.range="",this.values=[[]]})),O=e.createContext(w),E=e.createContext(new C),I=e.createContext([]);function j(t){var r,o,a=e.useContext(O),l=e.useContext(E),i=e.useContext(I),u=(null===(r=t.data)||void 0===r||null===(o=r.effectiveValue)||void 0===o?void 0:o.numberValue)||0,s=y(t.data);s==w.currencyInput&&(u=parseFloat(u.toFixed(2))),s==w.percentInput&&(u=parseFloat((100*u).toFixed(6)),t.style.paddingRight="1.01em");var d=function(e,t){var r=n({},e);return t==w.percentInput&&(r.paddingRight="1.01em"),r.border="none",r.maxHeight="",r.height="",r.width=parseFloat(r.width.replace("px",""))-(parseInt(r.borderLeft,10)||1)+"px",r}(t.style,s),f=c(e.useState(u),1)[0],v=c(e.useState(u.toString()),2),g=v[0],m=v[1],p=c(e.useState(""),2),b=p[0],h=p[1],x=function(e){e.target.select()};return e.createElement("input",{className:a.input+" "+s+" "+b,style:d,"data-orig":u,value:g,tabIndex:l.settings.columnTabbing?t.col:t.row,onChange:function(e){var r=function(e){return(e=(e=e.replace(/[^0-9\-\.]+/g,"")).replace(/(?<=(.*\..*))\.\./g,"")).replace(/(?!^)\-/g,"")}(e.target.value),n=r?parseFloat(r):0;n!=f?(h(a.dirtyInput),s==a.percentInput&&(n/=100),function(e,t,r){e.push({range:t,values:[[r]]})}(i,t.address,n)):(h(""),function(e,t){for(var r=0;r<e.length;r++){var n;(null===(n=e[r])||void 0===n?void 0:n.range)==t&&e.splice(r,1)}}(i,t.address)),m(r)},onFocus:x,onClick:x,onKeyDown:function(e){"Enter"===e.key&&l.settings.submitHandler(i)}})}function F(r,n,o){if(r=r.replace("#",""),!("error"in n)){if(null!=o&&o.createmaxtrix){var a,l,i,u,c=v((null===(a=n.sheets)||void 0===a||null===(l=a[0])||void 0===l||null===(i=l.data)||void 0===i||null===(u=i[0])||void 0===u?void 0:u.rowData)||[]),s=c.numrows,d=c.numcols;n.numrows=s,n.numcols=d,function(e){for(var t=0;t<e.numrows;t++){e.data[t]=[];for(var r=0;r<e.numcols;r++){var n,o,a,l,i,u,c,s,d,f=null===(n=e.sheets)||void 0===n||null===(o=n[0])||void 0===o||null===(a=o.data)||void 0===a||null===(l=a[0])||void 0===l||null===(i=l.rowData)||void 0===i||null===(u=i[t])||void 0===u||null===(c=u.values)||void 0===c?void 0:c[r];f?null===(s=e.data[t])||void 0===s||s.push(f):null===(d=e.data[t])||void 0===d||d.push(null)}}}(n)}t.createRoot(document.getElementById(r)).render(e.createElement(k,{data:n,settings:o}))}}function k(t){var r,n,o,a,l,i,u,c,s,d,f,g,m,p,b=e.useContext(O);if("error"in t.data)return e.createElement("table",{className:b.table+" "+b.error});var h=t.data,y=(null===(r=h.sheets)||void 0===r||null===(n=r[0])||void 0===n||null===(o=n.data)||void 0===o||null===(a=o[0])||void 0===a?void 0:a.rowData)||[],w=(null===(l=h.sheets)||void 0===l||null===(i=l[0])||void 0===i||null===(u=i.data)||void 0===u||null===(c=u[0])||void 0===c?void 0:c.rowMetadata)||[],C=(null===(s=h.sheets)||void 0===s||null===(d=s[0])||void 0===d||null===(f=d.data)||void 0===f||null===(g=f[0])||void 0===g?void 0:g.columnMetadata)||[],S=(null===(m=h.sheets)||void 0===m||null===(p=m[0])||void 0===p?void 0:p.merges)||[],I=t.settings||new x,j=h.numrows,F=h.numcols;if(!j||!F){var k=v(y);j=k.numrows,F=k.numcols}for(var R={settings:I,numrows:j,numcols:F,rowSizes:w,colSizes:C,data:y,merges:S},A=0;A<I.effects.length;A++)e.useEffect(I.effects[A]);return e.createElement(E.Provider,{value:R},e.createElement("table",{className:b.table},e.createElement(P,null),e.createElement(z,null)))}function P(){for(var t,r=e.useContext(O),n=e.useContext(E),o=[],a=0;a<n.numcols;a++){var l=(t=n.colSizes[a],{width:"".concat((null==t?void 0:t.pixelSize)||0,"px")});o.push(e.createElement("th",{className:r.th,style:l,key:a},p(a+1)))}return e.createElement("thead",{className:r.thead},e.createElement("tr",null,o))}function z(){for(var t=e.useContext(O),r=e.useContext(E),n=[],o=0;o<r.numrows;o++)r.data[o]&&n.push(e.createElement(R,{row:o,key:o}));return e.createElement("tbody",{className:t.tbody,onKeyDown:function(e){"Enter"===e.key&&r.settings.submitHandler()}},n)}function R(t){for(var r=e.useContext(O),n=e.useContext(E),o=[],a=0;a<n.numcols;a++)o.push(e.createElement(A,{row:t.row,col:a,key:a}));var l,i=(l=n.rowSizes[t.row],{height:"".concat((null==l?void 0:l.pixelSize)||0,"px")});return e.createElement("tr",{className:r.tr,style:i},o)}function A(t){var r,o,a,l=e.useContext(O),i=e.useContext(E),c=t.row,s=t.col,d=null===(r=i.data[c])||void 0===r||null===(o=r.values)||void 0===o?void 0:o[s],v=i.rowSizes[c],b=i.colSizes[s],w={},x={},C=l.td,S=function(e,t,r){var o=new f,a=e.filter((function(e){return e.startRowIndex==t&&e.startColumnIndex==r}));return o.startOfMerge=a.length>0,o.startOfMerge?(o.context=n({},a[0]),o):(a=e.filter((function(e){return(e.startRowIndex||0)<=t&&(e.endRowIndex||0)>t&&(e.startColumnIndex||0)<=r&&(e.endColumnIndex||0)>r})),o.inMerge=a.length>0,o.inMerge&&(o.context=n({},a[0])),o)}(i.merges,c,s);if(S.inMerge&&!S.startOfMerge)return null;if(w=function(e,t,r){var n,o={},a=null==e?void 0:e.effectiveFormat;if(!a)return o;null!=(null===(n=a.backgroundColorStyle)||void 0===n?void 0:n.rgbColor)?o.backgroundColor=g(a.backgroundColorStyle.rgbColor):null!=a.backgroundColor&&(o.backgroundColor=g(a.backgroundColor));var l=a.horizontalAlignment;null!=l&&(o.textAlign=l);var i=a.verticalAlignment;null!=i&&(o.verticalAlign=i);var u=a.padding;if(null!=u)for(var c=0,s=Object.entries(u);c<s.length;c++){var d=s[c];o["padding".concat(h(d[0]))]="".concat(d[1]||0,"px")}var f=a.borders;if(f)for(var v=0,p=Object.entries(f);v<p.length;v++){var b,y=p[v],w=y[1];if(w&&null!=(null===(b=w.colorStyle)||void 0===b?void 0:b.rgbColor)){var x="".concat(w.width||0,"px ").concat(w.style||"solid"," ").concat(g(w.colorStyle.rgbColor));o["border".concat(h(y[0]))]=x}}var C=a.textFormat;if(null!=C&&Object.assign(o,m(C)),null!=a.wrapStrategy&&("OVERFLOW_CELL"==a.wrapStrategy&&(o.overflow="visible",o.whiteSpace="pre"),"CLIP"==a.wrapStrategy&&(o.overflow="hidden",o.whiteSpace="pre"),"WRAP"==a.wrapStrategy&&(o.whiteSpace="pre-wrap")),t){var S=t.pixelSize||0;o.maxHeight="".concat(S,"px"),o.height="".concat(S,"px")}if(r){var O=r.pixelSize||0;o.maxWidth="".concat(O,"px"),o.width="".concat(O,"px")}return o}(d,v,b),S.startOfMerge){var I=S.context;x.colSpan=(I.endColumnIndex||0)-(I.startColumnIndex||0),x.rowSpan=(I.endRowIndex||0)-(I.startRowIndex||0)}return x["data-range"]=p(s+1)+(c+1),x["data-col"]=s,x["data-row"]=c,i.settings.configurable(d)?(a=e.createElement(j,{data:d,style:n({},w),row:c,col:s,address:x["data-range"]}),C+=" "+y(d),w.padding="0",w.backgroundColor="red"):a=e.createElement(M,{data:d}),null!=d&&d.note&&(x.title=d.note,x["data-toggle"]="tooltip"),e.createElement("td",u({className:C,style:w},x),a)}function M(t){if(t.data){if(null==t.data.textFormatRuns)return e.createElement(e.Fragment,null,t.data.formattedValue);for(var r=[],n=t.data.textFormatRuns.length-1,o=0;o<=n;o++){var a,l,i,u,c=null===(a=t.data.textFormatRuns[o])||void 0===a?void 0:a.format,s=t.data.formattedValue||"",d=0==o?0:(null===(l=t.data.textFormatRuns[o])||void 0===l?void 0:l.startIndex)||0,f=o==n?s.length:(null===(i=t.data.textFormatRuns[o+1])||void 0===i?void 0:i.startIndex)||0;s=s.slice(d,f);var v=m(c),g=void 0;g=null!=c&&null!==(u=c.link)&&void 0!==u&&u.uri?e.createElement("a",{href:c.link.uri,target:"_blank",key:0},s):e.createElement("span",{key:0},s);var p=e.createElement("span",{style:v,key:o},g);r.push(p)}return e.createElement(e.Fragment,null,r)}return e.createElement(e.Fragment,null)}export{k as GTable,w as GTableClasses,S as GTableInputData,x as GTableSettings,p as columnToLetter,b as letterToColumn,F as renderGTable};
