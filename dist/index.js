import*as e from"react";import*as t from"react-dom";function n(){return n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},n.apply(this,arguments)}class r{constructor(){this.startOfMerge=!1,this.inMerge=!1}}function a(e){let t={numrows:e.length,numcols:0};for(let n=0;n<t.numrows;n++){let r=e[n]?.values?.length;r&&r>t.numcols&&(t.numcols=r)}return t}function l(e){if(null==e)return"";return`rgb(${e.red?255*e.red:0}, ${e.green?255*e.green:0}, ${e.blue?255*e.blue:0})`}function o(e){let t={};return e?(null!=e.foregroundColorStyle?.rgbColor&&(t.color=l(e.foregroundColorStyle.rgbColor)),null!=e.fontFamily&&(t.fontFamily=e.fontFamily),null!=e.fontSize&&(t.fontSize=`${e.fontSize}pt`),null!=e.bold&&e.bold&&(t.fontWeight="bold"),null!=e.italic&&e.italic&&(t.fontStyle="italic"),null!=e.strikethrough&&e.strikethrough&&(t.textDecoration="line-through"),null!=e.underline&&e.underline&&(t.textDecoration="underline"),t):t}function s(e){let t,n="";for(;e>0;)t=(e-1)%26,n=String.fromCharCode(t+65)+n,e=(e-t-1)/26;return n}function u(e){let t=0,n=e.length;for(let r=0;r<n;r++)t+=(e.charCodeAt(r)-64)*Math.pow(26,n-r-1);return t}function i(e){return e.replace(/\w\S*/g,(function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}))}function c(e){if(!e)return"";let t=e.effectiveFormat;return null==t||null==t.numberFormat||null==t.numberFormat.pattern?"":t.numberFormat.pattern.startsWith('"$"')?d.currencyInput:"PERCENT"==t.numberFormat.type?d.percentInput:""}const d={error:"gtable-error",table:"gtable",thead:"gtable-head",th:"gtable-column-head",tbody:"gtable-body",tr:"gtable-row",td:"gtable-cell",input:"gtable-input",dirtyInput:"gtable-unsaved-changes",currencyInput:"gtable-currency",percentInput:"gtable-percentage"};class g{constructor(){this.columnTabbing=!1,this.effects=[],this.configurable=()=>!1,this.submitHandler=()=>{},this.createmaxtrix=!1}}class m{constructor(){this.range="",this.values=[[]]}}const f=e.createContext(d),p=e.createContext(new class{constructor(){this.settings=new g,this.numrows=0,this.numcols=0,this.rowSizes=[],this.colSizes=[],this.data=[],this.merges=[]}}),h=e.createContext([]);function b(t){const n=e.useContext(f),r=e.useContext(p),a=e.useContext(h);let l=t.data?.effectiveValue?.numberValue||0,o=c(t.data);o==d.currencyInput&&(l=parseFloat(l.toFixed(2))),o==d.percentInput&&(l=parseFloat((100*l).toFixed(6)),t.style.paddingRight="1.01em");let s=function(e,t){let n={...e};return t==d.percentInput&&(n.paddingRight="1.01em"),n.border="none",n.maxHeight="",n.height="",n.width=parseFloat(n.width.replace("px",""))-(parseInt(n.borderLeft,10)||1)+"px",n}(t.style,o),[u]=e.useState(l),[i,g]=e.useState(l.toString()),[m,b]=e.useState("");const x=e=>{e.target.select()};return e.createElement("input",{className:n.input+" "+o+" "+m,style:s,"data-orig":l,value:i,tabIndex:r.settings.columnTabbing?t.col:t.row,onChange:e=>{let r=function(e){let t=(e=e.replace(/[^0-9\-\.]+/g,"")).split(".");return t.length>2&&(e=t[0]+"."+t.slice(1).join("")),e.replace(/(?!^)\-/g,"")}(e.target.value),l=r?parseFloat(r):0;l!=u?(b(n.dirtyInput),o==n.percentInput&&(l/=100),function(e,t,n){e.push({range:t,values:[[n]]})}(a,t.address,l)):(b(""),function(e,t){for(let n=0;n<e.length;n++)e[n]?.range==t&&e.splice(n,1)}(a,t.address)),g(r)},onFocus:x,onClick:x,onKeyDown:e=>{"Enter"===e.key&&r.settings.submitHandler(a)}})}function x(n,r,l){if(n=n.replace("#",""),"error"in r)return;if(l?.createmaxtrix){let{numrows:e,numcols:t}=a(r.sheets?.[0]?.data?.[0]?.rowData||[]);r.numrows=e,r.numcols=t,function(e){for(let t=0;t<e.numrows;t++){e.data[t]=[];for(let n=0;n<e.numcols;n++){let r=e.sheets?.[0]?.data?.[0]?.rowData?.[t]?.values?.[n];r?e.data[t]?.push(r):e.data[t]?.push(null)}}}(r)}t.createRoot(document.getElementById(n)).render(e.createElement(w,{data:r,settings:l}))}function w(t){const n=e.useContext(f);if("error"in t.data)return e.createElement("table",{className:n.table+" "+n.error});let r=t.data,l=r.sheets?.[0]?.data?.[0]?.rowData||[],o=r.sheets?.[0]?.data?.[0]?.rowMetadata||[],s=r.sheets?.[0]?.data?.[0]?.columnMetadata||[],u=r.sheets?.[0]?.merges||[],i=t.settings||new g,c=r.numrows,d=r.numcols;c&&d||({numrows:c,numcols:d}=a(l));const m={settings:i,numrows:c,numcols:d,rowSizes:o,colSizes:s,data:l,merges:u};for(let t=0;t<i.effects.length;t++)e.useEffect(i.effects[t]);return e.createElement(p.Provider,{value:m},e.createElement("table",{className:n.table},e.createElement(y,null),e.createElement(C,null)))}function y(){const t=e.useContext(f),n=e.useContext(p),r=[];for(let l=0;l<n.numcols;l++){let o=(a=n.colSizes[l],{width:`${a?.pixelSize||0}px`});r.push(e.createElement("th",{className:t.th,style:o,key:l},s(l+1)))}var a;return e.createElement("thead",{className:t.thead},e.createElement("tr",null,r))}function C(){const t=e.useContext(f),n=e.useContext(p),r=[];for(let t=0;t<n.numrows;t++)n.data[t]&&r.push(e.createElement(S,{row:t,key:t}));return e.createElement("tbody",{className:t.tbody,onKeyDown:e=>{"Enter"===e.key&&n.settings.submitHandler()}},r)}function S(t){const n=e.useContext(f),r=e.useContext(p),a=[];for(let n=0;n<r.numcols;n++)a.push(e.createElement(E,{row:t.row,col:n,key:n}));let l=(o=r.rowSizes[t.row],{height:`${o?.pixelSize||0}px`});var o;return e.createElement("tr",{className:n.tr,style:l},a)}function E(t){const a=e.useContext(f),u=e.useContext(p);let d,{row:g,col:m}=t,h=u.data[g]?.values?.[m],x=u.rowSizes[g],w=u.colSizes[m],y={},C={},S=a.td,E=function(e,t,n){let a=new r,l=e.filter((e=>e.startRowIndex==t&&e.startColumnIndex==n));return a.startOfMerge=l.length>0,a.startOfMerge?(a.context={...l[0]},a):(l=e.filter((e=>(e.startRowIndex||0)<=t&&(e.endRowIndex||0)>t&&(e.startColumnIndex||0)<=n&&(e.endColumnIndex||0)>n)),a.inMerge=l.length>0,a.inMerge&&(a.context={...l[0]}),a)}(u.merges,g,m);if(E.inMerge&&!E.startOfMerge)return null;if(y=function(e,t,n){let r={},a=e?.effectiveFormat;if(!a)return r;null!=a.backgroundColorStyle?.rgbColor?r.backgroundColor=l(a.backgroundColorStyle.rgbColor):null!=a.backgroundColor&&(r.backgroundColor=l(a.backgroundColor));let s=a.horizontalAlignment;null!=s&&(r.textAlign=s);let u=a.verticalAlignment;null!=u&&(r.verticalAlign=u);let c=a.padding;if(null!=c)for(const e of Object.entries(c))r[`padding${i(e[0])}`]=`${e[1]||0}px`;let d=a.borders;if(d)for(const e of Object.entries(d)){let t=e[1];if(t&&null!=t.colorStyle?.rgbColor){let n=`${t.width||0}px ${t.style||"solid"} ${l(t.colorStyle.rgbColor)}`;r[`border${i(e[0])}`]=n}}let g=a.textFormat;if(null!=g&&Object.assign(r,o(g)),null!=a.wrapStrategy&&("OVERFLOW_CELL"==a.wrapStrategy&&(r.overflow="visible",r.whiteSpace="pre"),"CLIP"==a.wrapStrategy&&(r.overflow="hidden",r.whiteSpace="pre"),"WRAP"==a.wrapStrategy&&(r.whiteSpace="pre-wrap")),t){let e=t.pixelSize||0;r.maxHeight=`${e}px`,r.height=`${e}px`}if(n){let e=n.pixelSize||0;r.maxWidth=`${e}px`,r.width=`${e}px`}return r}(h,x,w),E.startOfMerge){let e=E.context;C.colSpan=(e.endColumnIndex||0)-(e.startColumnIndex||0),C.rowSpan=(e.endRowIndex||0)-(e.startRowIndex||0)}return C["data-range"]=s(m+1)+(g+1),C["data-col"]=m,C["data-row"]=g,u.settings.configurable(h)?(d=e.createElement(b,{data:h,style:{...y},row:g,col:m,address:C["data-range"]}),S+=" "+c(h),y.padding="0",y.backgroundColor="red"):d=e.createElement(F,{data:h}),h?.note&&(C.title=h.note,C["data-toggle"]="tooltip"),e.createElement("td",n({className:S,style:y},C),d)}function F(t){if(t.data){if(null==t.data.textFormatRuns)return e.createElement(e.Fragment,null,t.data.formattedValue);{let n=[],r=t.data.textFormatRuns.length-1;for(let a=0;a<=r;a++){let l=t.data.textFormatRuns[a]?.format,s=t.data.formattedValue||"",u=0==a?0:t.data.textFormatRuns[a]?.startIndex||0,i=a==r?s.length:t.data.textFormatRuns[a+1]?.startIndex||0;s=s.slice(u,i);let c,d=o(l),g=0;c=l?.link?.uri?e.createElement("a",{href:l.link.uri,target:"_blank",key:g},s):e.createElement("span",{key:g},s);let m=e.createElement("span",{style:d,key:a},c);n.push(m)}return e.createElement(e.Fragment,null,n)}}return e.createElement(e.Fragment,null)}export{w as GTable,d as GTableClasses,m as GTableInputData,g as GTableSettings,s as columnToLetter,u as letterToColumn,x as renderGTable};
