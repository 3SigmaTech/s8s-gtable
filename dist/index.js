import*as t from"react";import*as e from"react-dom";function r(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function n(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?r(Object(n),!0).forEach((function(e){i(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,d(n.key),n)}}function l(t,e,r){return e&&a(t.prototype,e),r&&a(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function i(t,e,r){return(e=d(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function u(){return u=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},u.apply(this,arguments)}function c(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,a,l,i=[],u=!0,c=!1;try{if(a=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(i.push(n.value),i.length!==e);u=!0);}catch(t){c=!0,o=t}finally{try{if(!u&&null!=r.return&&(l=r.return(),Object(l)!==l))return}finally{if(c)throw o}}return i}}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return s(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return s(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function d(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}var f=l((function t(){o(this,t),this.startOfMerge=!1,this.inMerge=!1}));function v(t){for(var e={numrows:t.length,numcols:0},r=0;r<e.numrows;r++){var n,o,a=null===(n=t[r])||void 0===n||null===(o=n.values)||void 0===o?void 0:o.length;a&&a>e.numcols&&(e.numcols=a)}return e}function g(t){if(null==t)return"";var e=t.red?255*t.red:0,r=t.green?255*t.green:0,n=t.blue?255*t.blue:0;return"rgb(".concat(e,", ").concat(r,", ").concat(n,")")}function m(t){var e,r={};return t?(null!=(null===(e=t.foregroundColorStyle)||void 0===e?void 0:e.rgbColor)&&(r.color=g(t.foregroundColorStyle.rgbColor)),null!=t.fontFamily&&(r["font-family"]=t.fontFamily),null!=t.fontSize&&(r["font-size"]="".concat(t.fontSize,"pt")),null!=t.bold&&t.bold&&(r["font-weight"]="bold"),null!=t.italic&&t.italic&&(r["font-style"]="italic"),null!=t.strikethrough&&t.strikethrough&&(r["text-decoration"]="line-through"),null!=t.underline&&t.underline&&(r["text-decoration"]="underline"),r):r}function p(t){for(var e,r="";t>0;)e=(t-1)%26,r=String.fromCharCode(e+65)+r,t=(t-e-1)/26;return r}function h(t){for(var e=0,r=t.length,n=0;n<r;n++)e+=(t.charCodeAt(n)-64)*Math.pow(26,r-n-1);return e}function b(t){if(!t)return"";var e=t.effectiveFormat;return null==e||null==e.numberFormat||null==e.numberFormat.pattern?"":e.numberFormat.pattern.startsWith('"$"')?y.currencyInput:"PERCENT"==e.numberFormat.type?y.percentInput:""}var y={error:"gtable-error",table:"gtable",thead:"gtable-head",th:"gtable-column-head",tbody:"gtable-body",tr:"gtable-row",td:"gtable-cell",input:"gtable-input",dirtyInput:"gtable-unsaved-changes",currencyInput:"gtable-currency",percentInput:"gtable-percentage"},w=l((function t(){o(this,t),this.columnTabbing=!1,this.effects=[],this.configurable=function(){return!1},this.submitHandler=function(){},this.createmaxtrix=!1})),x=l((function t(){o(this,t),this.settings=new w,this.numrows=0,this.numcols=0,this.rowSizes=[],this.colSizes=[],this.data=[],this.merges=[]})),C=l((function t(){o(this,t),this.range="",this.values=[[]]})),S=t.createContext(y),O=t.createContext(new x),E=t.createContext([]);function I(e){var r,o,a=t.useContext(S),l=t.useContext(O),i=t.useContext(E),u=(null===(r=e.data)||void 0===r||null===(o=r.effectiveValue)||void 0===o?void 0:o.numberValue)||0,s=b(e.data);s==y.currencyInput&&(u=parseFloat(u.toFixed(2))),s==y.percentInput&&(u=parseFloat((100*u).toFixed(6)),e.style["padding-right"]="1.01em");var d=function(t,e){var r=n({},t);return e==y.percentInput&&(r["padding-right"]="1.01em"),r.border="none",r["max-height"]="",r.height="",r.width=parseFloat(r.width.replace("px",""))-(parseInt(r["border-left"],10)||1)+"px",r}(e.style,s),f=c(t.useState(u),1)[0],v=c(t.useState(u.toString()),2),g=v[0],m=v[1],p=c(t.useState(""),2),h=p[0],w=p[1],x=function(t){t.target.select()};return t.createElement("input",{className:a.input+" "+s+" "+h,style:d,"data-orig":u,value:g,tabIndex:l.settings.columnTabbing?e.col:e.row,onChange:function(t){var r=function(t){return(t=(t=t.replace(/[^0-9\-\.]+/g,"")).replace(/(?<=(.*\..*))\.\./g,"")).replace(/(?!^)\-/g,"")}(t.target.value),n=r?parseFloat(r):0;n!=f?(w(a.dirtyInput),s==a.percentInput&&(n/=100),function(t,e,r){t.push({range:e,values:[[r]]})}(i,e.address,n)):(w(""),function(t,e){for(var r=0;r<t.length;r++){var n;(null===(n=t[r])||void 0===n?void 0:n.range)==e&&t.splice(r,1)}}(i,e.address)),m(r)},onFocus:x,onClick:x,onKeyDown:function(t){"Enter"===t.key&&l.settings.submitHandler(i)}})}function j(r,n,o){if(r=r.replace("#",""),!("error"in n)){if(null!=o&&o.createmaxtrix){var a,l,i,u,c=v((null===(a=n.sheets)||void 0===a||null===(l=a[0])||void 0===l||null===(i=l.data)||void 0===i||null===(u=i[0])||void 0===u?void 0:u.rowData)||[]),s=c.numrows,d=c.numcols;n.numrows=s,n.numcols=d,function(t){for(var e=0;e<t.numrows;e++){t.data[e]=[];for(var r=0;r<t.numcols;r++){var n,o,a,l,i,u,c,s,d,f=null===(n=t.sheets)||void 0===n||null===(o=n[0])||void 0===o||null===(a=o.data)||void 0===a||null===(l=a[0])||void 0===l||null===(i=l.rowData)||void 0===i||null===(u=i[e])||void 0===u||null===(c=u.values)||void 0===c?void 0:c[r];f?null===(s=t.data[e])||void 0===s||s.push(f):null===(d=t.data[e])||void 0===d||d.push(null)}}}(n)}e.createRoot(document.getElementById(r)).render(t.createElement(F,{data:n,settings:o}))}}function F(e){var r,n,o,a,l,i,u,c,s,d,f,g,m,p,h=t.useContext(S);if("error"in e.data)return t.createElement("table",{className:h.table+" "+h.error});e.data=e.data;var b=(null===(r=e.data.sheets)||void 0===r||null===(n=r[0])||void 0===n||null===(o=n.data)||void 0===o||null===(a=o[0])||void 0===a?void 0:a.rowData)||[],y=(null===(l=e.data.sheets)||void 0===l||null===(i=l[0])||void 0===i||null===(u=i.data)||void 0===u||null===(c=u[0])||void 0===c?void 0:c.rowMetadata)||[],x=(null===(s=e.data.sheets)||void 0===s||null===(d=s[0])||void 0===d||null===(f=d.data)||void 0===f||null===(g=f[0])||void 0===g?void 0:g.columnMetadata)||[],C=(null===(m=e.data.sheets)||void 0===m||null===(p=m[0])||void 0===p?void 0:p.merges)||[],E=e.settings||new w,I=e.data.numrows,j=e.data.numcols;if(!I||!j){var F=v(b);I=F.numrows,j=F.numcols}for(var z={settings:E,numrows:I,numcols:j,rowSizes:y,colSizes:x,data:b,merges:C},R=0;R<E.effects.length;R++)t.useEffect(E.effects[R]);return t.createElement(O.Provider,{value:z},t.createElement("table",{className:h.table},t.createElement(P,null),t.createElement(k,null)))}function P(){for(var e,r=t.useContext(S),n=t.useContext(O),o=[],a=0;a<n.numcols;a++){var l=(e=n.colSizes[a],{width:"".concat((null==e?void 0:e.pixelSize)||0,"px")});o.push(t.createElement("th",{className:r.th,style:l},p(a+1)))}return t.createElement("thead",{className:r.thead},o)}function k(){for(var e=t.useContext(S),r=t.useContext(O),n=[],o=0;o<r.numrows;o++)r.data[o]&&n.push(t.createElement(z,{row:o}));return t.createElement("tbody",{className:e.tbody,onKeyDown:function(t){"Enter"===t.key&&r.settings.submitHandler()}},n)}function z(e){for(var r=t.useContext(S),n=t.useContext(O),o=[],a=0;a<n.numcols;a++)o.push(t.createElement(R,{row:e.row,col:a}));var l,i=(l=n.rowSizes[e.row],{height:"".concat((null==l?void 0:l.pixelSize)||0,"px")});return t.createElement("tr",{className:r.tr,style:i},o)}function R(e){var r,o,a=t.useContext(S),l=t.useContext(O),i=e.row,c=e.col,s=null===(r=l.data[i])||void 0===r||null===(o=r.values)||void 0===o?void 0:o[c],d=l.rowSizes[i],v=l.colSizes[c],h={},y={},w=a.td,x=function(t,e,r){var o=new f,a=t.filter((function(t){return t.startRowIndex==e&&t.startColumnIndex==r}));return o.startOfMerge=a.length>0,o.startOfMerge?(o.context=n({},a[0]),o):(a=t.filter((function(t){return(t.startRowIndex||0)<=e&&(t.endRowIndex||0)>e&&(t.startColumnIndex||0)<=r&&(t.endColumnIndex||0)>r})),o.inMerge=a.length>0,o.inMerge&&(o.context=n({},a[0])),o)}(l.merges,i,c);if(x.inMerge&&!x.startOfMerge)return null;if(h=function(t,e,r){var n,o={},a=null==t?void 0:t.effectiveFormat;if(!a)return o;null!=(null===(n=a.backgroundColorStyle)||void 0===n?void 0:n.rgbColor)?o["background-color"]=g(a.backgroundColorStyle.rgbColor):null!=a.backgroundColor&&(o["background-color"]=g(a.backgroundColor));var l=a.horizontalAlignment;null!=l&&(o["text-align"]=l);var i=a.verticalAlignment;null!=i&&(o["vertical-align"]=i);var u=a.padding;if(null!=u)for(var c=0,s=Object.entries(u);c<s.length;c++){var d=s[c];o["padding-".concat(d[0])]="".concat(d[1]||0,"px")}var f=a.borders;if(f)for(var v=0,p=Object.entries(f);v<p.length;v++){var h,b=p[v],y=b[1];if(y&&null!=(null===(h=y.colorStyle)||void 0===h?void 0:h.rgbColor)){var w="".concat(y.width||0,"px ").concat(y.style||"solid"," ").concat(g(y.colorStyle.rgbColor));o["border-".concat(b[0])]=w}}var x=a.textFormat;if(null!=x&&Object.assign(o,m(x)),null!=a.wrapStrategy&&("OVERFLOW_CELL"==a.wrapStrategy&&(o.overflow="visible",o["white-space"]="nowrap"),"CLIP"==a.wrapStrategy&&(o.overflow="hidden",o["white-space"]="nowrap"),"WRAP"==a.wrapStrategy&&(o["white-space"]="pre-wrap")),e){var C=e.pixelSize||0;o["max-height"]="".concat(C,"px"),o.height="".concat(C,"px")}if(r){var S=r.pixelSize||0;o["max-width"]="".concat(S,"px"),o.width="".concat(S,"px")}return o}(s,d,v),x.startOfMerge){var C=x.context;y.colspan=(C.endColumnIndex||0)-(C.startColumnIndex||0),y.rowspan=(C.endRowIndex||0)-(C.startRowIndex||0)}y["data-range"]=p(c+1)+(i+1),y["data-col"]=c,y["data-row"]=i;var E=[];return l.settings.configurable(s)?(E.push(t.createElement(I,{data:s,style:n({},h),row:i,col:c,address:y["data-range"]})),w+=" "+b(s),h.padding="0",h["background-color"]="red"):E.push(t.createElement(M,{data:s})),null!=s&&s.note&&(y.title=s.note,y["data-toggle"]="tooltip"),t.createElement("td",u({className:w,style:h},y),E)}function M(e){if(e.data){if(null==e.data.textFormatRuns)return t.createElement(t.Fragment,null,e.data.formattedValue||"");for(var r=[],n=e.data.textFormatRuns.length-1,o=0;o<=n;o++){var a,l,i,u,c=null===(a=e.data.textFormatRuns[o])||void 0===a?void 0:a.format,s=e.data.formattedValue||"",d=0==o?0:(null===(l=e.data.textFormatRuns[o])||void 0===l?void 0:l.startIndex)||0,f=o==n?s.length:((null===(i=e.data.textFormatRuns[o+1])||void 0===i?void 0:i.startIndex)||0)-1;s=s.slice(d,f);var v=m(c),g=t.createElement("p",{style:v});g.props.children=[],null!=c&&null!==(u=c.link)&&void 0!==u&&u.uri?g.props.children.push(t.createElement("a",{href:c.link.uri,target:"_blank"},s)):g.props.children.push(t.createElement(t.Fragment,null,s)),r.push(g)}return t.createElement(t.Fragment,null,r)}return t.createElement(t.Fragment,null)}export{F as GTable,y as GTableClasses,C as GTableInputData,w as GTableSettings,p as columnToLetter,h as letterToColumn,j as renderGTable};
